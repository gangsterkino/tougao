"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[710],{53538:function(H,B,s){s.r(B);var O=s(15009),D=s.n(O),b=s(99289),v=s.n(b),y=s(5574),c=s.n(y),h=s(67294),r=s(23323),t=s(68872),F=s(16775),P=s(71230),o=s(15746),d=s(71971),p=s(73318),I=s(79489),A=s(2507),e=s(85893),T=function(){var U=(0,A.Z)(),l=U.currentUser,w=(0,h.useState)({name:l.name,role:l.role,gender:"",education:"",major:""}),x=c()(w,2),E=x[0],R=x[1],K=r.Z.useForm(),L=c()(K,1),f=L[0],W=r.Z.useForm(),S=c()(W,1),C=S[0],V=(0,h.useState)(!1),g=c()(V,2),$=g[0],j=g[1];(0,h.useEffect)(function(){l&&fetch("http://127.0.0.1:5000/api/user/details?username=".concat(l.name,"&role=").concat(l.role)).then(function(n){return n.json()}).then(function(n){n.message?t.ZP.error(n.message):(R(n),console.log(E))}).catch(function(n){t.ZP.error("\u83B7\u53D6\u7528\u6237\u8BE6\u60C5\u5931\u8D25")})},[l]),(0,h.useEffect)(function(){E&&f.setFieldsValue(E)},[E,f]);var G=function(i){var _=i.education,m=i.major;fetch("http://127.0.0.1:5000/api/user/update_profile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l.name,role:l.role,education:_,major:m})}).then(function(u){return u.json()}).then(function(u){u.message?t.ZP.success(u.message):t.ZP.error("\u66F4\u65B0\u5931\u8D25")}).catch(function(u){t.ZP.error("\u66F4\u65B0\u5931\u8D25")})},J=function(){var n=v()(D()().mark(function i(_){var m,u,Z,M;return D()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return m=_.currentPassword,u=_.newPassword,a.prev=1,a.next=4,fetch("http://127.0.0.1:5000/api/user/update_password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l.name,role:l.role,current_password:m,new_password:u})});case 4:return Z=a.sent,a.next=7,Z.json();case 7:M=a.sent,Z.ok?(t.ZP.success("\u5BC6\u7801\u66F4\u65B0\u6210\u529F"),C.resetFields(),j(!1)):t.ZP.error(M.message||"\u5BC6\u7801\u66F4\u65B0\u5931\u8D25"),a.next=14;break;case 11:a.prev=11,a.t0=a.catch(1),t.ZP.error("\u5BC6\u7801\u66F4\u65B0\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5");case 14:case"end":return a.stop()}},i,null,[[1,11]])}));return function(_){return n.apply(this,arguments)}}(),N=function(){j(!0)},z=function(){j(!1)};return(0,e.jsxs)("div",{style:{padding:"20px"},children:[(0,e.jsx)("h2",{children:"\u4E2A\u4EBA\u4E2D\u5FC3"}),(0,e.jsx)(F.Z,{bordered:!1,style:{width:"100%",marginBottom:"20px"},children:(0,e.jsxs)(r.Z,{form:f,name:"profile",onFinish:G,labelCol:{span:6},wrapperCol:{span:18},children:[(0,e.jsxs)(P.Z,{gutter:16,children:[(0,e.jsx)(o.Z,{span:12,children:(0,e.jsx)(r.Z.Item,{label:"\u59D3\u540D",name:"name",children:(0,e.jsx)(d.Z,{disabled:!0,placeholder:"\u59D3\u540D"})})}),(0,e.jsx)(o.Z,{span:12,children:(0,e.jsx)(r.Z.Item,{label:"\u8EAB\u4EFD",name:"role",children:(0,e.jsx)(d.Z,{disabled:!0,placeholder:"\u8EAB\u4EFD"})})}),(0,e.jsx)(o.Z,{span:12,children:(0,e.jsx)(r.Z.Item,{label:"\u6027\u522B",name:"gender",children:(0,e.jsx)(d.Z,{disabled:!0,placeholder:"\u6027\u522B"})})}),(0,e.jsx)(o.Z,{span:12,children:(0,e.jsx)(r.Z.Item,{label:"\u5B66\u5386",name:"education",children:(0,e.jsx)(d.Z,{placeholder:"\u8BF7\u8F93\u5165\u5B66\u5386"})})}),(0,e.jsx)(o.Z,{span:12,children:(0,e.jsx)(r.Z.Item,{label:"\u4E13\u4E1A",name:"major",children:(0,e.jsx)(d.Z,{placeholder:"\u8BF7\u8F93\u5165\u4E13\u4E1A"})})})]}),(0,e.jsxs)(r.Z.Item,{wrapperCol:{offset:6,span:18},children:[(0,e.jsx)(p.ZP,{type:"primary",htmlType:"submit",style:{marginRight:250},children:"\u66F4\u65B0\u8D44\u6599"}),(0,e.jsx)(p.ZP,{type:"primary",onClick:N,children:"\u4FEE\u6539\u5BC6\u7801"})]})]})}),(0,e.jsx)(I.Z,{title:"\u4FEE\u6539\u5BC6\u7801",visible:$,onCancel:z,footer:null,bodyStyle:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,e.jsxs)(r.Z,{form:C,name:"changePassword",onFinish:J,labelCol:{span:8},wrapperCol:{span:16},children:[(0,e.jsx)(P.Z,{gutter:24,justify:"center",children:(0,e.jsx)(o.Z,{span:24,children:(0,e.jsx)(r.Z.Item,{label:"\u5F53\u524D\u5BC6\u7801",name:"currentPassword",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5F53\u524D\u5BC6\u7801"}],children:(0,e.jsx)(d.Z.Password,{placeholder:"\u8BF7\u8F93\u5165\u5F53\u524D\u5BC6\u7801"})})})}),(0,e.jsx)(P.Z,{gutter:24,justify:"center",children:(0,e.jsx)(o.Z,{span:24,children:(0,e.jsx)(r.Z.Item,{label:"\u65B0\u5BC6\u7801",name:"newPassword",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801"}],children:(0,e.jsx)(d.Z.Password,{placeholder:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801"})})})}),(0,e.jsx)(P.Z,{gutter:24,justify:"center",children:(0,e.jsx)(o.Z,{span:24,children:(0,e.jsx)(r.Z.Item,{label:"\u786E\u8BA4\u5BC6\u7801",name:"confirmPassword",dependencies:["newPassword"],rules:[{required:!0,message:"\u8BF7\u786E\u8BA4\u65B0\u5BC6\u7801"},function(n){var i=n.getFieldValue;return{validator:function(m,u){return!u||i("newPassword")===u?Promise.resolve():Promise.reject(new Error("\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4"))}}}],children:(0,e.jsx)(d.Z.Password,{placeholder:"\u786E\u8BA4\u65B0\u5BC6\u7801"})})})}),(0,e.jsx)(r.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,e.jsx)(p.ZP,{type:"primary",htmlType:"submit",children:"\u4FEE\u6539\u5BC6\u7801"})})]})})]})};B.default=T}}]);
